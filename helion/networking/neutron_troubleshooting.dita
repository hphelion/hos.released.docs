<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="neutron_troubleshooting">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Network Service Troubleshooting </title>
  <abstract><shortdesc outputclass="hdphidden">Troubleshooting scenarios with resolutions for the
      Networking service.</shortdesc></abstract>
  <body>
    <!--not tested-->
    <p conkeyref="HOS-conrefs/applies-to"/>
    <!--<section><title>Overview</title></section><section><title>Troubleshooting packets</title> Path MTU discovery </section>-->
    <section><title>Troubleshooting Network failures</title></section>
    <section>
      <title>CVR HA - Split-brain result of failover of L3 agent when master comes back up</title>
      <p>This situation is specific to when L3 HA is configured and a network failure occurs to the node
      hosting the currently active l3 agent. L3 HA is intended to provide HA in situations where the
      l3-agent crashes or the node hosting an l3-agent crashes/restarts. In the case of a physical
      networking issue which isolates the active l3 agent, the stand-by l3-agent takes over but when
      the physical networking issue is resolved, traffic to the VMs is disrupted due to a
      "split-brain" situation in which traffic is split over the two L3 agents. The solution is to
      restart the L3-agent that was originally the master. 
      </p>
    </section>
    
    <section>
      <title>OVSvApp loses connectivity with vCenter</title>
      <p>If the OVSvApp loses connectivity with the vCenter cluster, you will receive the following
        errors: </p>
      <ul id="ul_ykf_vs2_wv">
        <li>The OVSvApp VM will go into ERROR state</li>
        <li>The OVSvApp VM will not get IP address</li>
      </ul>
      <p>When you see these symptoms: <ol id="ol_cs3_lt2_wv">
          <li>Restart the OVSvApp agent on the OVSvApp VM.</li>
          <li> Execute the following command to restart the Network (Neutron) service:
            <codeblock>sudo service neutron-ovsvapp-agent restart</codeblock></li>
        </ol></p>
    </section>

    <!--  docs 3098 -->
    <section><title>Fail over a plain CVR router because the node became unavailable:</title>
      <ol>
        <li> Get a list of l3 agent UUIDs which can be used in the commands that follow
          <codeblock> neutron agent-list | grep l3 </codeblock>
        </li>

        <li>Determine the current host
          <codeblock> neutron l3-agent-list-hosting-router &lt;router uuid> </codeblock>
        </li>

        <li>Remove the router from the current host
          <codeblock>neutron l3-agent-router-remove &lt;current l3 agent uuid> &lt;router uuid></codeblock>
        </li>

        <li>Add the router to a new host
          <codeblock>neutron l3-agent-router-add &lt;new l3 agent uuid> &lt;router uuid> </codeblock>
        </li>
      </ol>
    </section>

  </body>
</topic>

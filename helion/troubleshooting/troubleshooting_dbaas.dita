<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="troubleshooting_dbaas">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Troubleshooting the Database Service
    (DBaaS)</title>
  <abstract><shortdesc outputclass="hdphidden">Troubleshooting scenarios with resolutions for the
      Database service.</shortdesc>We have gathered some of the common issues and troubleshooting
    steps that will help when resolving issues that occur with the Database service.</abstract>
  <body>
    <section><title>Database Instances Stuck in a Non-Active State</title>
      <p>If you have database instances that are stuck in a non-active state and wish to delete
        them, these steps will help.</p>
      <p><b>Issue:</b> When listing your instances, you find that you have some stuck in a
        non-active state, such as a <codeph>BUILD</codeph> state as shown below:</p>
      <codeblock>$ trove list
+--------------------------------------+--------------------------+-----------+-------------------+--------+-----------+------+
| ID                                   | Name                     | Datastore | Datastore Version | Status | Flavor ID | Size |
+--------------------------------------+--------------------------+-----------+-------------------+--------+-----------+------+
| 02d773bf-c898-453f-b8e3-81012bd25f85 | DBaaSCheck-1456273382.68 | mysql     | 5.5               | BUILD  | 3         |  100 |
+--------------------------------------+--------------------------+-----------+-------------------+--------+-----------+------+</codeblock>
      <p>If you attempt to delete the instance you receive an error that states the instance isn't
        ready, like this:</p>
      <codeblock>$ trove delete 02d773bf-c898-453f-b8e3-81012bd25f85
ERROR: Instance 02d773bf-c898-453f-b8e3-81012bd25f85 is not ready. (HTTP 422)</codeblock>
      <p><b>Resolution:</b> You can access the Trove service database and delete the database entry
        for the instance to remove it.</p>
      <ol>
        <li>Start by locating the Trove database instance. <ol>
            <li>Log in to the lifecycle manager.</li>
            <li>Source your admin credentials: <codeblock>source ~/service.osrc</codeblock></li>
            <li>List out your Compute instances, grepping for database:
              <codeblock>nova list | grep database</codeblock></li>
            <li>SSH to the Trove database instance</li>
          </ol></li>
        <li>Once you have accessed the Trove database instance via SSH, follow these steps: <ol>
            <li>Gain root access: <codeblock>sudo -s</codeblock></li>
            <li>Access the MySQL command line: <codeblock>mysql</codeblock></li>
            <li>Access the <codeph>trove</codeph> database:
              <codeblock>mysql> use trove</codeblock></li>
            <li>Select the instance you want to remove. In our case we are going to use the example
              instance from above, which had UUID
                <codeph>02d773bf-c898-453f-b8e3-81012bd25f85</codeph> so the command would be:
              <codeblock>mysql> select status_id, status_description from service_statuses where instance_id = '02d773bf-c898-453f-b8e3-81012bd25f85';</codeblock></li>
            <li>Update the status of the instance so you can then remove it. We are once again using
              our example instance, which had UUID
                <codeph>02d773bf-c898-453f-b8e3-81012bd25f85</codeph> so the command would be:
              <codeblock>mysql> update service_statuses set status_id = 1, status_description = 'active' where instance_id = '02d773bf-c898-453f-b8e3-81012bd25f85';</codeblock></li>
            <li>Exit the MySQL command line: <codeblock>mysql> quit</codeblock></li>
          </ol></li>
        <li>Now the database instance should be in an <codeph>ACTIVE</codeph> state and you can
          remove it.</li>
      </ol>
    </section>
  </body>
</topic>

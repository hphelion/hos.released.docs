<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="password_encryption">
  <title><ph conkeyref="HOS-conrefs/product-title-both"/>Encryption of Passwords and Sensitive Data</title>
  <body>
    <p conkeyref="HOS-conrefs/applies-to-all"/>
    <p> In <keyword keyref="kw-hos-phrase-21"/>, sensitive connection data is encrypted. The passwords that are
      encrypted include: <ul>
        <li>Inter-service passwords generated by the configuration processor (Keystone, MySQL,
          RabbitMQ and Vertica passwords) </li>
        <li>Secret keys generated by the configuration processor (MySQL cluster-id, erlang cookie
          for RabbitMQ, Horizon secret key, Keystone admin token) </li>
        <li>User-supplied passwords (iLO passwords, Block Storage backend passwords) </li>
      </ul>
    </p>
    
    <section>
      <table frame="all" rowsep="1" colsep="1" id="table_b5t_qwp_rt">
        <tgroup cols="4">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>What is encrypted</entry>
              <entry>Encryption mechanism</entry>
              <entry>Is password changable</entry>
              <entry>Is encryption key changable</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Inter-service passwords and secret keys generated by the configuration
                processor (Keystone, MySQL, RabbitMQ and Vertica passwords) </entry>
              <entry>Uses PyCrypto libraries &amp; Ansible vault for encryption</entry>
              <entry>No</entry>
              <entry><p>Yes</p><p>Passphrase for the encryption key will be prompted when running
                  Ansible playbook. Can also use command </p> ask-ansible-pass</entry>
            </row>
            <row>
              <entry>User supplied passwords (iLO passwords, Block Storage backend passwords) </entry>
              <entry> OpenSSL</entry>
              <entry>Yes</entry>
              <entry>
                <p>Yes</p>
                <p>The environment variable HOS_USER_PASSWORD_ENCRYPT_KEY must contain the key used
                  to encrypt those passwords.</p>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table> Other protected data: <ul>
        <li>The SSH private key used by Ansible to connect to client nodes from the deployer is
          protected with a passphrase. </li>
        <li>The Swift swift-hash prefix and suffix values are
          encrypted<!--, or will be when the relevant patches land -->. </li>
        <li>All of the Ansible variables generated by the configuration processor are encrypted and
          held in Ansible Vault. </li>
      </ul>
      <p>However, if a user wants to change the encryption keys then that can be done for all
        categories of password and secret-keys listed below, and the processes are documented.</p>
      <p>The ssh private key passphrase needs to be entered once before any Ansible plays are run
        against the cloud.</p><p>The configuration processor encryption key will be prompted for
        when the relevant Ansible play is run. Once the configuration processor output has been
        encrypted, all subsequent Ansible plays need to have --ask-ansible-pass added to the command
        line to ensure that the encryption key which is needed by Ansible is prompted for. </p>
      <p>Finally, if user-supplied passwords have been encrypted (this process uses the OpenSSL
        library) then the environment variable HOS_USER_PASSWORD_ENCRYPT_KEY must contain the key
        used to encrypt those passwords.</p><p>In the case where the HOS_USER_PASSWORD_ENCRYPT_KEY
        environment variable is either null, the empty string, or not defined, then no encryption
        will be performed on your passwords when using the hosencrypt.py script.</p>
      <p> The generated passwords are stored in Ansible inputs generated by the configuration
        processor and also in the persistent state information maintained by the configuration
        processor.</p>
    </section>
       <section id="protection"><title>Protecting Sensitive Data on the Deployer</title>
         <p> There are a number of mechanisms that can be used to protect sensitive data such as
        passwords, some Ansible inputs, and the SSH key used by Ansible on the deployer. See the
        installation documents for details. Please remember the need to guard against exposure of
        your environment variables, which may happen through observation over the shoulder.</p>
      <p>There are instructions included in the installation documents that show how to encrypt your
        data using the <codeph>hosencrypt.py</codeph> script. You may want to change the encryption
        keys used to protect your sensitive data in the future and this shows you how:</p>
      <ul>
        <li><b>SSH keys</b> - Run the command below to change the passphrase used to protect the
          key: <codeblock>ssh-keygen -f id_rsa -p</codeblock></li>
        <li><b>configuration processor Key</b> - If you wish to change an encryption password that
          you have already used when running the configuration processor then enter the existing
          password at the first prompt and the new password at the second prompt when running the
          configuration processor playbook. See <xref href="../installation/install_entryscale_kvm.dita#install_kvm/encrypt">Encrypting
            Password during configuration processor</xref> for more details.</li>
        <li><b>iLO passwords, VSA password if encrypted with <codeph>hosencrypt.py</codeph></b> -
          Rerun the utility specifying a new encryption key when prompted. You will need to enter
          the plain text passwords at the password prompt.</li>
      </ul>
    </section>
   <section><title>Reading Encrypted Files</title> To view a file encrypted using Vault, you can use
      ansible-vault to edit the file:
      <codeblock>ansible-vault edit &lt;file>
Vault password:</codeblock> Provide the encryption
      password that you supplied to the configuration processor during installation when prompted. </section>
    
    <section><title>Data Not Encrypted in Previous Versions</title>
    
    <p>Note: There was a issue in the configuration processor shipped with HPE Helion OpenStack 2.0 whereby it wasn't encrypting its Ansible
    output if encryption was enabled. We have fixed this bug in v2.1. If you've run the configuration processor with encryption turned-on  in HPE Helion OpenStack 2.0
    then you will need to delete the git branch used to store the Ansible output and recreate it in order to clear the unencrypted Ansible output.</p>
    <p>You must do so on the lifecycle manager node:</p>
   <codeblock>cd helion
git branch -D ansible
git checkout -b ansible
git checkout site</codeblock>
    </section>
  </body>
</topic>

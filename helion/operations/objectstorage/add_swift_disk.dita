<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="add_swift_disk">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Adding Additional Disks to a Swift Node</title>
  <abstract><shortdesc outputclass="hdphidden">Steps for adding additional disks to your Swift
      nodes.</shortdesc>If you want to add additional disks to your existing Swift nodes, these
    steps will show you how to.</abstract>
  <body>


    <section id="notes"><title>Notes</title>
      <p>The following are things to keep in mind when increasing your disk capacity in your Swift
        nodes:</p>
      <ul>
        <li>You can add multiple disks at the same time, there is no need to do it one at a
          time.</li>
        <li><b>IMPORTANT!</b> You must add the <b>same</b> number of disks to each server that the
          disk model applies to. So, for example, if you have a single cluster of three Swift object
          servers and you want to increase capacity and decide to add two additional disks, you must
          add two each of your three Swift object servers.</li>
      </ul>
    </section>

    <section><title>Steps</title>
      <ol>
        <li>Verify the general health of the Swift system. <ol>
            <li>SSH to one of the Swift ring builder servers. See <xref
                href="../troubleshooting/objectstorage/identify_ring_builder.dita"/> for details on
              how to determine your Swift ring builder server.</li>
            <li>Run this command which will check on the status of the replication process: <codeblock>sudo swift-recon -r- v</codeblock>
              <p>The oldest completion time can indicate that the replication process is very busy.
                If it is more than 15-20 minutes then the object replication process is probably
                still busy, wait for some time before proceeding further.</p></li>
          </ol>
        </li>
        <li>Perform the disk replacement. <ol>
            <li>Shut down the first Swift object server you wish to add disks to.</li>
            <li>Add the additional disks to the physical server.</li>
            <li>Power the server on.</li>
            <li>Monitor the replication process using the command below. The amount of time it takes
              to replicate the data will vary based on the total amount of object capacity this node
              contains. <codeblock>sudo swift-recon -r -v</codeblock>
              <p>Use the oldest completion time as an indication of when the replication process is
                complete.</p></li>
            <li>Repeat steps a-d for each of the Swift object servers you are adding the disks to,
              one at a time.</li>
          </ol>
          <note>If the additional disks can be added to the Swift object servers online (for
            example, via hot plugging) then there is no need to do the last two steps.</note>
        </li>
        <li>Update your cloud configuration with the details of your additional disks. <ol>
            <li>Edit the disk configuration file to add your new disks. <p>Path to file:</p>
              <codeblock>~/helion/my_cloud/definition/data/disks_swobj.yml</codeblock>
              <p>Example showing the addition of a single new disk, indicated by the
                  <codeph>/dev/sdd</codeph>, in bold:</p>
              <codeblock>device-groups:
  - name: SwiftObject
    devices:
      - name: "/dev/sdb"
      - name: "/dev/sdc"
      <b>- name: "/dev/sdd"</b>
    consumer:
      name: swift
      ...</codeblock>
              <note>For more details, see <xref
                  href="../../architecture/input_model/configobj/configurationobjects.dita"/> for
                more details on how the disk model works.</note></li>
            <li>Configure the Swift weight-step value in the
                <codeph>~/helion/my_cloud/definition/data/swift/rings.yml</codeph> file. See <xref
                href="swift_weight_attribute.dita"/> for details on how to do this.</li>
            <li>Commit the changes to
              Git:<codeblock>cd ~helion
git commit -a -m "adding additional Swift disks"</codeblock></li>
            <li>Run the configuration
              processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
            <li>Update your deployment
              directory:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</codeblock></li>
          </ol>
        </li>
        <li>Configure the added disks. The disk drives that are added should be clean. They should
          either contain no partitions or a single partition the size of the entire disk. It should
          not contain a file system or any volume groups. Failure to comply will cause errors and
          the disk will not be added. <p>For more details, see <xref
              href="../../administration/objectstorage/swift_device_groups.dita"/>.</p>
          <ol>
            <li>Obtain the hostname for the Swift node(s) you are adding disks to. <codeblock>cat ~/helion/my_cloud/info/server_info.yml</codeblock>
              <p>In the next step you will need to specify each of the hostnames for the Swift nodes
                you added disks to. You have two options for doing this: a wildcard or a textfile
                you reference. If you added disks to all of the Swift object servers in your
                environment and they all have the same prefix (for example,
                  <codeph>helion-cp1-swobj...</codeph>) then you can use a wildcard like
                  <codeph>helion-cp1-swobj*</codeph>. If you only added disks to a set of nodes but
                not all of them, you can create a file, for example
                  <codeph>/tmp/Swift_Object_Servers</codeph> and enter the hostnames of each of the
                nodes you added disks to, one per line, that you can then reference.</p></li>
            <li>To configure the operating system on the added drives, use this playbook. Ensure you
              specify the Swift object nodes you added disks to according to the note in the
              previous step.
              <codeblock>cd ~/stack/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit &lt;hostname_or_reference_file></codeblock></li>
          </ol>
        </li>
        <li>Verify that Swift services are running on all of your servers:
          <codeblock>cd ~/stack/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts swift-status.yml</codeblock></li>
        <li>If everything looks okay with the Swift status, then apply the changes to your Swift
          rings with this playbook:
          <codeblock>cd ~/stack/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts swift-deploy.yml</codeblock></li>
        <li>At this point your Swift rings will begin rebalancing. You should wait until replication
          has completed or min-part-time has elapsed (whichever is longer). For more information,
          see <xref href="safe_rebalance_deploy_ring.dita"/>.</li>
      </ol>
    </section>
  </body>
</topic>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="DesignateInfoBlox">
  <title><ph conkeyref="HOS-conrefs/product-title"/>Install Designate with InfoBlox </title>
  <body>
    <p conkeyref="HOS-conrefs/applies-to"/>
    <section id="Overview">
      <title>Install Designate with InfoBlox</title>
      <p><keyword keyref="kw-hos"/> Designate service can be installed with the <b>InfoBlox</b>
        backend instead of the default <b>PowerDNS</b> backend. In order to use InfoBlox as the
        backend, all prerequisites must be satisfied and the configuration of InfoBlox complete.
          <note>No DNS server will be deployed onto the <keyword keyref="kw-hos"/> nodes. Instead,
          zones will be hosted on the <b>InfoBlox</b> servers.</note></p>
    
    </section>
    <section id="prereqs">
      <title>Prerequisites</title>
        <ol>
          <li>An existing InfoBlox system deployed within your organization.</li>
          <li>IPs and other credentials required to access the InfoBlox WS API.</li>
          <li>Network connectivity to and from the cluster containing designate and the InfoBlox WS
          API.</li>
        </ol>
    </section>
    
    <section id="ConfigureBackend">
      <title>Configure the Backend</title>
      <p>If not already present, Designate components must be placed on a cluster.  Additionally,
        ensure the default <b>powerdns</b> component has been removed, and <b>bind</b> has not been
        added.  Replace the <codeph>designate-mdns</codeph> component with the 
        <codeph>designate-mdns-external</codeph> component.
        <codeblock>control-planes: 
          - name: control-plane-1
          region-name: region1
          - lifecycle-manager-target
          
          clusters:
          - name: cluster1
          service-components:
          - lifecycle-manager
          - mysql
          - ip-cluster
          - apache2
          - ...
          - designate-api
          - designate-central
          - designate-pool-manager
          - designate-zone-manager
          - designate-mdns-external
          - designate-client</codeblock></p>
      <p>You will need to provide Designate information details on your InfoBlox deployment. 
        Open the designate pool-manager configuration template:
        <codeblock>$ cd ~/helion/my_cloud
$ nano config/designate/pool-manager.conf.j2</codeblock></p>
      <p>In the <codeph>config/designate/pool-manager.conf.j2</codeph>, find the following code
        block:
        <codeblock>{# backends.infoblox(wapi_url="https://.../",
username="myuser",
password="mypassword",
ns_group="designate",
nameservers=[],
also_notifies=[],
masters=designate_pool_masters) #}</codeblock></p>
      <p>Make the following changes:
        <ol>
          <li>Uncomment the block.  In Jinja2, this means replacing the {# and #} markers with {{ and }}.</li>
          <li>Fill in the API URL, username, password, and all remaining fields.</li>
          <li>Save the file.</li>
        </ol>
        </p>
      <p>Once complete, the block should look like this: 
        <codeblock>{{ backends.infoblox(wapi_url="https://infoblox.mycorp.com/",
username="hos-designate",
password="MySecretPassword",
ns_group="designate",
nameservers=['192.0.2.1', '192.0.2.2', '192.0.2.3'],
also_notifies=[],
masters=designate_pool_masters) }}</codeblock></p>
        
      <p>You will need to inspect and commit the changes before proceeding with the deployment:
        <codeblock>$ git diff
diff --git a/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2 b/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
index 614aac2..a69c5a1 100644
 --- a/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
 +++ b/hos/ansible/roles/designate-pool-manager/templates/pool-manager.conf.j2
 @@ -53,13 +53,13 @@ backend_url = {{ designate_backend_url }}
 also_notifies=["193.108.155.34", "23.73.134.141", "80.67.64.148", "23.73.134.237", "23.73.133.141", "23.73.133.237", "80.67.64.10", "72.246.0.10", "72.247.45.157", "72.246.192.168", "193.108.152.143", "60.254.128.45", "72.247.45.110", "72.247.45.65", "72.247.45.25"],
 masters=designate_pool_masters) #}
          
 -{# backends.infoblox(wapi_url="https://.../",
 -                     username="myuser",
 -                     password="mypassword",
 +{{ backends.infoblox(wapi_url="https://infoblox.mycorp.com/",
 +                     username="hos-designate",
 +                     password="MySecretPassword",
 ns_group="designate",
 -                     nameservers=[],
 +                     nameservers=['192.0.2.1', '192.0.2.2', '192.0.2.3'],
 also_notifies=[],
 -                     masters=designate_pool_masters) #}
 +                     masters=designate_pool_masters) }}
          
{# End Pool Assisted Configuration #}
        </codeblock></p>
          <p>Commit changes.
            <codeblock>$ git commit -a -m "Configure Designate's InfoBlox Backend"
[site 7a00f61] Configure Designate's InfoBlox Backend
1 file changed, 5 insertions(+), 5 deletions(-)</codeblock></p>
	</section>

  </body>
</topic>
